openapi: 3.1.0

info:
  title: Singpods Ops API BETA
  description: Proxy API for external integrations to the Singpods ecosystem.
  version: 0.2.0
  contact:
    name: Singpods
    url: https://www.singpods.com/
    email: hello@singpods.com

tags:
  - name: locations
    description: Location operations
  - name: location-pods
    description: Location pod operations
  - name: bookings
    description: Booking operations
  - name: reservations
    description: Reservation operations (two-step booking flow)

servers:
  - url: https://staging-connect.singpods.com/api/0.2.0
    description: Singpods Staging API
  - url: https://connect.singpods.com/api/0.2.0
    description: Singpods Production API

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
  schemas:
    createReservationRequest:
      type: object
      required:
        - locationId
        - podId
        - startDate
        - endDate
        - customerName
        - notificationType
        - amount
      properties:
        locationId:
          type: string
          format: uuid
          description: ID of the location
        podId:
          type: string
          format: uuid
          description: ID of the pod
        startDate:
          type: string
          format: date-time
          description: "Datetime to start the session [format: ISO 8601]"
        endDate:
          type: string
          format: date-time
          description: "Datetime to end the session [format: ISO 8601]"
        customerName:
          type: string
          description: Name of the customer booking
        customerEmail:
          type: ['null', string]
          format: email
          description: Email of the customer (required if notificationType is 'email')
        customerPhone:
          type: ['null', string]
          description: Phone number of the customer (required if notificationType is 'phone')
        notificationType:
          type: string
          enum: [email, phone]
          description: How to notify the customer of their booking code
        amount:
          type: integer
          minimum: 0
          description: Price of the booking in integer penny value e.g. Â£10 should be depicted as 1000
        personAmount:
          type: integer
          minimum: 1
          default: 1
          description: Number of people for the session
        songsAmount:
          type: integer
          minimum: 1
          default: 1
          description: Number of songs for the session
        micsAmount:
          type: integer
          minimum: 1
          default: 1
          description: Number of microphones for the session
    reservationResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the reservation
        state:
          type: string
          enum: [pending, confirmed, expired, cancelled, failed]
          description: Current state of the reservation
        booking_code:
          type: ['null', string]
          description: The access code for the session (only present after confirmation)
        expires_at:
          type: ['null', string]
          format: date-time
          description: When the reservation expires if not confirmed (ISO 8601)
        session_start:
          type: string
          format: date-time
          description: Datetime when the session starts (ISO 8601)
        session_end:
          type: string
          format: date-time
          description: Datetime when the session ends (ISO 8601)
    errorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error message describing what went wrong
    cancelBookingRequest:
      type: object
      properties:
        pinCode:
          type: integer
          description: The pin code given for the session
    createBookingResponse:
      type: object
      properties:
        code:
          type: string
          description: 4/5 digit access code

security:
  - BearerAuth: []

paths:
  "/locations":
    get:
      tags: ["locations"]
      summary: Returns all rentors locations
      description: Get all singpod locations available for the authenticated rentor.
      operationId: getLocations
      responses:
        "200":
          description: A list of location details
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                      example: ecf6fcfd-afc1-453c-ad9e-19ae63e68590
                    head_image:
                      type: string
                      format: uri
                      nullable: true
                      example: null
                    logo:
                      type: string
                      format: uri
                      nullable: true
                      example: null
                    name:
                      type: string
                      example: Test location
                    city:
                      type: string
                      example: London
                    canvas_album_id:
                      type: string
                      format: uuid
                      nullable: true
                      example: null
                    location:
                      type: string
                      example: Location name
                    created_at:
                      type: string
                      format: date-time
                      example: "2024-07-31T07:50:32.238Z"
                    updated_at:
                      type: string
                      format: date-time
                      example: "2024-09-19T12:47:56.339Z"
                    booking_interval:
                      type: integer
                      description: Interval in milliseconds for booking
                      example: 1800000
                    session_interval:
                      type: integer
                      description: Interval in milliseconds for session
                      example: 1800000
                    price_for_interval_in_gbp:
                      type: number
                      format: float
                      example: 30
                    price_for_person_in_gbp:
                      type: number
                      format: float
                      example: 15
                    price_per_song_in_gbp:
                      type: number
                      format: float
                      example: 5
                    price_per_mic_in_gbp:
                      type: number
                      format: float
                      example: 10
                    is_per_song_enabled:
                      type: boolean
                      example: false
                    is_per_mic_enabled:
                      type: boolean
                      example: false
                    persons_select:
                      type: boolean
                      example: false
                    rentorId:
                      type: string
                      format: uuid
                      example: 9d0b93dd-32d9-45f8-b2ec-e612af036b64
                    timezone:
                      type: string
                      example: "Europe/London"
                    showQr:
                      type: boolean
                      example: true
                    alias:
                      type: string
                      example: test
                    published:
                      type: boolean
                      example: true
                    triggers_disable:
                      type: boolean
                      example: true
                    genres_disable:
                      type: boolean
                      example: false
                    statistics_disable:
                      type: boolean
                      example: false
  "/locations/{id}":
    get:
      tags: ["locations"]
      summary: Returns location by given ID
      description: Get a single singpod location available for the authenticated rentor, based on the id given.
      operationId: getLocation
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Details of a single location
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                    example: b266da4d-95cd-4547-a787-a8c3b54803a8
                  head_image:
                    type: string
                    format: uri
                    example: "https://sing-pods-images.s3.amazonaws.com/61cc7337-ea1b-4542-972e-0c7c7c836dcd-sp%20logo%20icon.png"
                  logo:
                    type: string
                    format: uri
                    example: "https://sing-pods-images.s3.amazonaws.com/c385c9e0-8bf9-4b95-b91c-c2f67ff2e378-Icon%20pink%402x.png"
                  name:
                    type: string
                    example: SingPods - Gamechangers
                  city:
                    type: string
                    example: London
                  canvas_album_id:
                    type: string
                    format: uuid
                    example: 50934958-7d63-4857-9c98-33af82d881dc
                  location:
                    type: string
                    example: The Lighthouse
                  created_at:
                    type: string
                    format: date-time
                    example: "2024-03-26T16:24:27.455Z"
                  updated_at:
                    type: string
                    format: date-time
                    example: "2024-05-09T09:49:31.091Z"
                  booking_interval:
                    type: integer
                    description: Interval in milliseconds for booking
                    example: 900000
                  session_interval:
                    type: integer
                    description: Interval in milliseconds for session
                    example: 1800000
                  price_for_interval_in_gbp:
                    type: number
                    format: float
                    example: 1
                  price_for_person_in_gbp:
                    type: number
                    format: float
                    example: 1
                  price_per_song_in_gbp:
                    type: number
                    format: float
                    example: 5
                  price_per_mic_in_gbp:
                    type: number
                    format: float
                    example: 10
                  is_per_song_enabled:
                    type: boolean
                    example: false
                  is_per_mic_enabled:
                    type: boolean
                    example: false
                  persons_select:
                    type: boolean
                    example: true
                  rentorId:
                    type: string
                    format: uuid
                    example: 9d0b93dd-32d9-45f8-b2ec-e612af036b64
                  timezone:
                    type: string
                    example: "Europe/London"
                  showQr:
                    type: boolean
                    example: false
                  alias:
                    type: string
                    example: singpods-game
                  published:
                    type: boolean
                    example: true
                  triggers_disable:
                    type: boolean
                    example: false
                  genres_disable:
                    type: boolean
                    example: false
                  statistics_disable:
                    type: boolean
                    example: false
  "/locations/{locationId}/pods":
    get:
      tags: ["location-pods"]
      summary: Returns location pods by given locationId and bookings
      description: Get a list of pods available at the given location ID along with already booked customers
      operationId: getLocationPods
      parameters:
        - name: locationId
          in: path
          required: true
          schema:
            type: string
        - name: date
          in: query
          required: true
          description: Date string used to filter the results to the pods available on a particular date
          schema:
            type: string
      responses:
        "200":
          description: Details of pods and associated bookings
          content:
            application/json:
              schema:
                type: object
                properties:
                  pods:
                    type: array
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: SingPods - A
                        id:
                          type: string
                          format: uuid
                          example: 3bb68d28-c5c0-4da8-b0b3-50b422a22fb8
                        bookings:
                          type: array
                          items:
                            type: object
                            properties:
                              id:
                                type: integer
                                example: 426
                              startDate:
                                type: string
                                format: date-time
                                example: "2024-10-26T09:00:00.000Z"
                              endDate:
                                type: string
                                format: date-time
                                example: "2024-10-26T09:30:00.000Z"
                              username:
                                type: string
                                example: John
                              email:
                                type: string
                                example: "+447833385999"
                              persons:
                                type: integer
                                example: 1
                              mics:
                                type: integer
                                example: 0
                              songs:
                                type: integer
                                example: 0
                              assignedBy:
                                type: string
                                example: VENUE_ADMIN
                              note:
                                type: string
                                nullable: true
                                example: null
                  totalPages:
                    type: integer
                    example: 1
                  totalItems:
                    type: integer
                    example: 1

  "/reservations":
    post:
      tags: ["reservations"]
      summary: Create a reservation
      description: |
        Creates a temporary reservation that must be confirmed within 1 minute.
        This is the first step in the two-step booking flow. After creating a reservation,
        use the confirm endpoint to finalize the booking and receive the access code.
      operationId: createReservation
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/createReservationRequest"
            examples:
              EmailNotification:
                summary: Reservation with email notification
                value:
                  locationId: "54f11c47-9f7c-4891-9b9e-8ff1aaaa6d40"
                  podId: "3dffc4f-182a-4826-956e-f2ba89137350"
                  startDate: "2024-10-21T14:00:00+01:00"
                  endDate: "2024-10-21T14:30:00+01:00"
                  customerName: "John Doe"
                  customerEmail: "john@example.com"
                  notificationType: "email"
                  amount: 1000
              PhoneNotification:
                summary: Reservation with phone notification
                value:
                  locationId: "54f11c47-9f7c-4891-9b9e-8ff1aaaa6d40"
                  podId: "3dffc4f-182a-4826-956e-f2ba89137350"
                  startDate: "2024-10-21T14:00:00+01:00"
                  endDate: "2024-10-21T14:30:00+01:00"
                  customerName: "John Doe"
                  customerPhone: "+447833385999"
                  notificationType: "phone"
                  amount: 1000
                  personAmount: 2
                  songsAmount: 5
                  micsAmount: 2
      responses:
        "201":
          description: Reservation created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/reservationResponse"
              example:
                id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                state: "pending"
                booking_code: null
                expires_at: "2024-10-21T13:15:00+01:00"
                session_start: "2024-10-21T14:00:00+01:00"
                session_end: "2024-10-21T14:30:00+01:00"
        "401":
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              example:
                error: "Unauthorized"
        "404":
          description: Location or pod not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              example:
                error: "Resource not found"
        "422":
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
              example:
                message: "The given data was invalid."
                errors:
                  notificationType: ["The notification type field is required."]
        "502":
          description: Upstream service error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              example:
                error: "Upstream service error"

  "/reservations/{id}/confirm":
    post:
      tags: ["reservations"]
      summary: Confirm a reservation
      description: |
        Confirms a pending reservation and returns the booking access code.
        The reservation must be confirmed before it expires (1 minute after creation).
      operationId: confirmReservation
      parameters:
        - name: id
          in: path
          required: true
          description: UUID of the reservation to confirm
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Reservation confirmed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/reservationResponse"
              example:
                id: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
                state: "confirmed"
                booking_code: "12345"
                expires_at: "2024-10-21T13:15:00+01:00"
                session_start: "2024-10-21T14:00:00+01:00"
                session_end: "2024-10-21T14:30:00+01:00"
        "401":
          description: Unauthorized - Invalid or missing authentication token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              example:
                error: "Unauthorized"
        "404":
          description: Reservation not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              example:
                error: "Reservation not found"
        "409":
          description: Conflict - Reservation already confirmed, cancelled, or failed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              examples:
                AlreadyConfirmed:
                  summary: Reservation already confirmed
                  value:
                    error: "Reservation already confirmed"
                Cancelled:
                  summary: Reservation was cancelled
                  value:
                    error: "Reservation was cancelled"
                Failed:
                  summary: Reservation failed
                  value:
                    error: "Reservation failed"
        "410":
          description: Gone - Reservation has expired
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              example:
                error: "Reservation has expired"
        "502":
          description: Upstream service error
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/errorResponse"
              example:
                error: "Upstream service error"

  "/bookings":
    delete:
      tags: ["bookings"]
      summary: Cancel a booking
      description: Cancel a booking based on the pincode given for entry.
      operationId: cancelBooking
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/cancelBookingRequest"
            examples:
              Successful:
                summary: Successful Request
                value:
                  pinCode: 12345
      responses:
        "204":
          description: All went well
